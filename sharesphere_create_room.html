<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel = "icon" href = "logo.jpg" type = "image/x-icon">
    <title>Share Sphere - Create room!</title>
    <link rel="icon" href = "#">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body{
            background-color: #aff0e3;
            font-family: 'Trebuchet MS';
            margin: 0;
            padding: 0;
        }
        form{
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            width: 60%;
            max-width: 600px;
            margin: auto;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            font-size: larger;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            border: 1px solid #e9ecef;
        }
        #form input
        {
            padding: 15px;
            margin: 15px 0;
            border: 2px solid #ced4da;
            border-radius: 10px;
            font-size: medium;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        #form input:focus {
            border-color: #7DCFB6;
            box-shadow: 0 0 5px rgba(125, 207, 182, 0.5);
            outline: none;
        }
        h1, h2{
            text-align: center;
        }
        #submit
        {
            background: linear-gradient(135deg, #FC9F5B 0%, #e29578 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: large;
            font-weight: bold;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            align-self: center;
        }
        #submit:hover
        {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        #logo
        {
            display: block;
            margin-left: auto;
            margin-right: auto;
            width: 20%;
            border-radius: 50%;
            height: 5rem;
            width: 5rem;
            margin-bottom: 15px;
        }
        #navbar {
            width: 100%;
            background-color: #001f3f;
            padding: 0;
            position: sticky;
            top: 0;
            left: 0;
        }

        #nav-container {
            margin: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #name {
            display: flex;
            align-items: center;
        }

        #name span {
            font-size: 1.5rem;
            font-weight: bold;
            color: #edf6f9;
        }

        #desktop-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 3.5rem;
            font-size: 0.8rem;
        }

        #desktop-nav a {
            color: #edf6f9;
            font-weight: 500;
            transition: color 0.5s ease;
            font-size: medium;
            text-decoration: none;
            font-size: 1.1rem;
        }

        #desktop-nav a:hover {
            color: #ffddd2;
        }

        #auth-buttons {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.5rem 1rem;
            border-radius: 20%;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        #asi {
            background: transparent;
            border: 2px solid #83c5be;
            color: #edf6f9;
            font-size: 1rem;
            border-radius: 5px;
        }

        #asi:hover {
            background: #83c5be;
            color: #006d77;
        }

        #asu {
            background: #e29578;
            border: 2px solid #e29578;
            color: #edf6f9;
            font-size: 1rem;
            border-radius: 5px;
        }
        #logout
        {
            background: #00b4d8;
            border: 2px solid #00b4d8;
            color: #edf6f9;
            font-size: 1rem;
            border-radius: 5px;
        }
    #asu:hover, #logout:hover {
        background: #ff0000;
        color: #ffffff;
    }
        #more
        {
            display: none;
            background-color: transparent;
            font-size: 1.8rem;
            color: white;
        }
        #username
        {
            text-align: center;
            font-size: larger;
            font-weight: bolder;
        }
        #userinfo
        {
            background-color: transparent;
            width: fit-content;
            margin: auto;
            padding: 10px;
            border-radius: 10px;
            font-size: larger;
            font-weight: bold;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }
        #createbtn
        {
            display: block;
            margin-left: auto;
            margin-right: auto;
            background-color: #006d77;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: large;
            font-weight: bold;
            margin-top: 15px;
            margin-bottom: 15px;
        }
        #loading
        {
            position: fixed;
            display: none;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background-color: rgba(255, 255, 255);
            z-index: 1000;
            text-align: center;
        }
        @media (min-width: 751px) {
            #auth-buttons {
                flex-direction: row;
                gap: 1rem;
            }
            #desktop-nav
            {
                display: flex;
                flex-direction: row;
                gap: 3.5rem;
            }
            #more{
                display: none ;
                border: 2px solid #edf6f9;
                padding: 4px;
                margin: 2px;
            }
        }
        @media (max-width: 750px) {
            #desktop-nav {
                display: none;
            }
            #more {
                display: block;
            }
            #nav-container{
                flex-direction: column;
            }
            #auth-buttons{
                flex-direction: column;
                gap: 0.2rem;
            }
        }
    </style>
</head>
<body>
    <div id = "loading">
        <img src = "loading.gif">
    </div>
    <nav id="navbar">
        <div id="nav-container">
            <div id="name">
                <span>Share Sphere</span>
            </div>
            <button id = "more">&#9776;</button>
            <div id="desktop-nav">
                <a href="sharesphere_public_page.html">Home</a>
                <a href = "sharesphere_your_account.html">Your account</a>
                <a href = "sharesphere_friends.html">My friends</a>
                <a href ="sharesphere_find_rooms.html">Join room</a>
                <a href="sharesphere_about_us.html">About us </a>
                <a href="sharesphere_feedback.html">Feedback</a>
            </div>

            <div id="auth-buttons">
                <button id="asi">Sign In</button>
                <button id="asu">Sign Up</button>
                <button id="logout">Log out</button>
            </div>
            
        </div>
    </nav>
    <h1><i class="fas fa-users-cog"></i> Share Sphere - Create a room</h1>
    
    <form id = "form">
        <br>
        <label>Create room:-</label>
        <input placeholder  = "Room name" name="comments" id = "roomname" required>
        <input type = "text" placeholder="Room description" id = "roomd">
        <br>
        <button type="submit" id = "submit"><i class="fas fa-plus"></i> Submit</button>
</form>
<button id='createbtn' onclick='window.location.href="sharesphere_find_rooms.html"'>Join a room</button>
<footer style="text-align: center; padding: 20px; color: rgba(255,0,0,0.7); font-size: 0.9rem; margin-top: 50px;">
            Â© 2025 Share Sphere - Copyrights reserved 
        </footer>
<script type ="module">

    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js";
    import { getFirestore, doc, setDoc, addDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";
    import {
        getAuth,
        signInWithEmailAndPassword,
        createUserWithEmailAndPassword,
        onAuthStateChanged,
        signOut,
        sendEmailVerification
        } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBDXLWL-WySSNnRLL1khrnuWYnUE3-OF74",
        authDomain: "share-sphere-v-8.firebaseapp.com",
        databaseURL: "https://share-sphere-v-8-default-rtdb.firebaseio.com",
        projectId: "share-sphere-v-8",
        storageBucket: "share-sphere-v-8.firebasestorage.app",
        messagingSenderId: "931094139319",
        appId: "1:931094139319:web:4d202e258a5c4231ea9832",
        measurementId: "G-DKHQ2H23VM"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    let db = getFirestore(app);
    let auth = getAuth();
    let comments = document.getElementById("comments");
    let submit = document.getElementById("submit");
    let form = document.getElementById("form");
    let asu = document.getElementById("asu");
    let asi = document.getElementById("asi");
    let logout = document.getElementById("logout");

    asi.addEventListener("click", () =>
    {
        window.location.href = "sharesphere_sign_in.html";
    });
    asu.addEventListener("clcik", () =>
    {
        window.location.href = "sharespher_sign_in.html";
    });
    logout.addEventListener("click", fnclogout);
    let more = document.getElementById("more");
    more.addEventListener("click", () => {
      let dnav = document.getElementById("desktop-nav");
      dnav.style.display = "flex";
      dnav.style.flexDirection = "column";
      dnav.style.gap = "0";
      more.style.display = "none";
    });
    function fnclogout()
    {
        signOut(auth)
        .then(() => {
            window.location.href = "sharesphere_logout.html"
        })
        .catch((error) => {
            alert("Error occured while logging out");
        });
    }
    onAuthStateChanged(auth, async (user) => {
        if(!user.emailVerified)
        {
            window.location.href = "sharesphere_email_verify.html";
        }
        if(user)
        {
            form.addEventListener("submit", (e)=> formsubmit(e));
            function formsubmit(e)
            {
                let submit = document.getElementById("submit");
                submit.disabled = true;
                e.preventDefault();
                let roomname = document.getElementById("roomname").value;
                let roomd = document.getElementById("roomd").value;
                let loading = document.getElementById("loading");
                loading.style.display = "block";
                setDoc(doc(db, "rooms", roomname), {
                    created_by: user.email,
                    room_name: roomname,
                    room_description: roomd,
                    created_at: new Date(),
                    members: [user.email]
                })
                .then(() => {
                    alert("Room created succesfully!");
                    form.reset();
                    loading.style.display = "none";
                    window.location.href = "sharesphere_room.html?roomid=" + roomname;
                })
                .catch((error) => {
                        alert ("Error Occured on creating room! Please retry");
                        console.log(error);
                        loading.style.display = "none";
                });
                
            }
            asu.style.display = "none";
            asi.style.display = "none";
            logout.style.display = "block";
            let logo = document.getElementById("logo");

        }
        else
        {
            logout.style.display = "none";
        }
    });
        onAuthStateChanged(auth, (user) =>
        {
            if (user)
            {
                asu.style.display = "none";
                asi.style.display = "none";
                logout.style.display = "block";
            }
            else{
                asu.style.display = "block";
                asi.style.display = "block";
                logout.style.display = "none";
            }
        }); 

</script>
<script>
        testSpeed();
async function testSpeed() {
    const fileUrl = "https://speed.cloudflare.com/__down?bytes=1000000";
    const fileSize = 1 * 1024 * 1024; // 1MB in bytes

    const startTime = performance.now();

    try {
        const response = await fetch(fileUrl, { cache: "no-store" });
        await response.blob(); // Wait for file to fully download
    } catch (e) {
        alert("Connect to a better internet connection to continue using our application");
        window.location.href = "index.html";
    }

    const endTime = performance.now();
    const durationInSeconds = (endTime - startTime) / 1000;

    const speedBps = fileSize / durationInSeconds;        // bytes per second
    const speedMbps = (speedBps * 8) / (1024 * 1024);     // convert to Mbps

    if (speedMbps < 0.1)
    {
        alert("Connect to a better internet connection to continue using our application");
        window.location.href = "index.html";
    }
    else if (speedMbps < 0.5)
    {
        alert("Looks like you have a slow internet connection, some of the fetures might not work properly!");
    }
}
</script>
</body>
</html>
