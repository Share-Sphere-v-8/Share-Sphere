<html>
    <head>
        <title>Share Sphere - Sign Up</title>
        <link rel="icon" href = "logo.jpg" type = "image/x-icon">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        <style>
            body {
                text-align: center;
                background: linear-gradient(135deg, #aff0e3 0%, #edf6f9 100%);
                font-family: 'Trebuchet MS';
                margin: 0px;
                padding: 0px;
            }
            h1 {
                text-align: center;
                color: #006d77;
                margin-top: 50px;
            }
            #box {
                width: 60%;
                max-width: 500px;
                margin: auto;
                padding: 40px;
                border-radius: 20px;
                background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
                border: 1px solid #e9ecef;
                display: flex;
                flex-direction: column;
                align-items: center;
            }
            #signup-form {
                width: 100%;
                display: flex;
                flex-direction: column;
                align-items: center;
            }
            .input-container {
                position: relative;
                width: 100%;
                margin: 15px 0;
            }
            input {
                width: 100%;
                padding: 15px 15px 15px 50px;
                border: 2px solid #ced4da;
                border-radius: 10px;
                font-size: medium;
                background-color: #ffffff;
                transition: border-color 0.3s ease, box-shadow 0.3s ease;
            }
            input:focus {
                border-color: #7DCFB6;
                box-shadow: 0 0 5px rgba(125, 207, 182, 0.5);
                outline: none;
            }
            .input-container i {
                position: absolute;
                left: 15px;
                top: 50%;
                transform: translateY(-50%);
                color: #6c757d;
                font-size: 18px;
            }
            #submit {
                background: linear-gradient(135deg, #FC9F5B 0%, #e29578 100%);
                color: white;
                border: none;
                padding: 15px 30px;
                border-radius: 25px;
                cursor: pointer;
                font-size: large;
                font-weight: bold;
                transition: transform 0.2s ease, box-shadow 0.2s ease;
                margin-top: 20px;
                width: 100%;
                max-width: 200px;
            }
            #submit:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            }
            h2 {
                color: #006d77;
                margin-bottom: 30px;
            }
            a {
                color: #e29578;
                text-decoration: none;
                margin-top: 20px;
            }
            a:hover {
                text-decoration: underline;
            }
            #dobtext {
                color: #6c757d;
                font-size: small;
                margin-bottom: 5px;
            }
            #loading
        {
            display: flex;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 1000;
        }
        #googleBtn {
            background-color: #ffffff;
            color: #3c4043;
            border: 1px solid #dadce0;
            border-radius: 4px;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 500;
            font-family: 'Roboto', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: background-color 0.2s, box-shadow 0.2s;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 200px;
            margin-top: 20px;
        }
        #googleBtn i {
            color: #ea4335;
            font-size: 16px;
        }
        #googleBtn:hover {
            background-color: #f8f9fa;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }
        </style>
    </head>
    <body>
        <div id = "loading">
            <img src = "loading.gif">
        </div>
        <h1>Share Sphere - Sign Up</h1>
        <div id = "box">
            <form id="signup-form">
                <h2>Create an account now</h2>
                <button id="googleBtn"><i class="fab fa-google"></i> Continue with Google</button><br>
                <div style="margin: 10px; font-weight: bold; color: #6c757d;">OR</div>
                <div id = "divfullname">
                    <input type="text" id="fullname" name="fullname" placeholder="Username" required>
                </div><br>
                <div id = "divdob">
                    <div id ="dobtext" >Date of birth:- <i>(optional)</i></div>
                    <input type="date" id = "dob" name = "dob" placeholder="Date of birth"min="1850-01-01" max="2011-12-31">
                </div><br>
                <div id = "divbiodata">
                    <input type = "text" id = "biodata" name = "biodata" placeholder = "Bio Data" required>
                </div><br>
                <div id = "divemail">
                    <input type="email" id ="email" name = "email" placeholder = "Email" required>
                </div><br>
                <div id = "divpassword">
                    <input type = "password" id = "password" name = "password" placeholder = "Password" required>
                </div><br>
                <div id = "divpasswordconfirm">
                    <input type = "password" id = "passwordconfirm" name = "password" placeholder = "Confirm Password" required>
                </div>
                <br><br>
                <input type = "submit" id = "submit" value="Sign Up">
                <div id ="alreadyacc" style="margin-top: 20px;"><a href = "sharesphere_sign_in.html">Already have an account? Click here to Sign in</a></div>
            </form>
        </div>
        <footer style="text-align: center; padding: 20px; color: rgba(255,0,0,0.7); font-size: 0.9rem; margin-top: 50px;">
            Â© 2025 Share Sphere - Copyrights reserved 
        </footer>
    </body>
    <script type="module">
        
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-analytics.js";
        import {
        getAuth,
        GoogleAuthProvider, 
        signInWithPopup,
        fetchSignInMethodsForEmail,
        signInWithEmailAndPassword,
        createUserWithEmailAndPassword,
        onAuthStateChanged,
        signOut,
        sendEmailVerification
        } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDoc, doc, setDoc} from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        const firebaseConfig = {
            apiKey: "AIzaSyBDXLWL-WySSNnRLL1khrnuWYnUE3-OF74",
            authDomain: "share-sphere-v-8.firebaseapp.com",
            databaseURL: "https://share-sphere-v-8-default-rtdb.firebaseio.com",
            projectId: "share-sphere-v-8",
            storageBucket: "share-sphere-v-8.firebasestorage.app",
            messagingSenderId: "931094139319",
            appId: "1:931094139319:web:4d202e258a5c4231ea9832",
            measurementId: "G-DKHQ2H23VM"
        };
      
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        let auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        let loading = document.getElementById("loading");
        loading.style.display = "none";

        document.getElementById("googleBtn").addEventListener("click", () => {

    signInWithPopup(auth, provider)
      .then(async (result) => {

        const user = result.user;

        // STORE USER INFO IN VARIABLES
        const userName = user.displayName;
        const userEmail = user.email;
        const userPhoto = user.photoURL;
        const userUID = user.uid;

        await setDoc(doc(db, "users", userEmail),
        {
            username: userName,
            email:userEmail,
            friends: 0,
            pfpUrl: userPhoto,
            timestap: new Date()
        });
        const loginMethod = user.providerData[0].providerId;  
        console.log("Name:", userName);
        console.log("Email:", userEmail);
        console.log("Photo:", userPhoto);
        console.log("UID:", userUID);
        console.log("Login Method:", loginMethod);
        window.location.href = "sharesphere_public_page.html";

      })
      .catch(async (error) => {

        if (error.code === "auth/account-exists-with-different-credential") {
          const email = error.customData.email;
          const methods = await fetchSignInMethodsForEmail(auth, email);

          if (methods.includes("password")) {
            alert("You already created an account using Email/Password. Please log in using email.");
          }
        } else {
          console.error(error);
        }

      });

  });

        let submit = document.getElementById("signup-form")
        submit.addEventListener ("submit", signup);
        function signup(event){
            let submut = document.getElementById("submit");
            submut.disabled = true;
            event.preventDefault();
            let fullname = document.getElementById("fullname").value;
            let email = document.getElementById("email").value;
            let password = document.getElementById("password").value;
            let passwordconfirm = document.getElementById("passwordconfirm").value;
            let dob = document.getElementById("dob").value
            let biodata = document.getElementById("biodata").value
            if (password === passwordconfirm){
                if (password.length < 6){
                    alert ("Password should be at least 6 characters long.");
                    return;
                }
                loading.style.display = "flex";
                createUserWithEmailAndPassword(auth, email, password)
                .then (async (userCredential) => {
                    let user = userCredential.user;
                    await sendEmailVerification(user)
                    .catch((error) =>{
                        alert("An error occured, for further queries please mail to sharespherev.8@gmail.com or please kindly give us a feedback in our website.");
                    })
                    .then(()=>
                    {
                        setDoc(doc(db, "users", email),
                    {
                        username: fullname,
                        email:email,
                        date_of_birth: dob,
                        biodata: biodata,
                        friends: 0,
                        pfp: "",
                        timestap: new Date()
                    })
                    .then(() => {
                        alert ("Acoount created, an verification email has been sent, please click on the link and verify your email to continue using our application! (The mail might have reached the spam folder in your email");
                        window.location.href = "sharesphere_email_verify.html";
                    })
                    .catch((error) => {
                        alert ("Error Occured in sending data! Please retry");
                        console.log(error);
                    });
                    });
                })
                .catch((error) => {
                alert("Error occurred while creating account! Please try again.");
                console.error("Error creating user: ", error);
                });
            }
            else {
                alert ("The password fields are differnt.");
            }
        }
        
    </script>
</html>
